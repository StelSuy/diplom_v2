# üêõ –°–ü–ò–°–û–ö –û–®–ò–ë–û–ö –ò –ë–ê–ì–û–í

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 1. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–§–∞–π–ª:** `app/api/routes/auth.py`  
**–°—Ç—Ä–æ–∫–∞:** 10-11

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
if payload.username != settings.admin_username or payload.password != settings.admin_password:
    raise HTTPException(status_code=401, detail="Invalid credentials")
```

–ü–∞—Ä–æ–ª—å —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env` –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.

**–†–∏—Å–∫:** –ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ `.env`, –æ–Ω –ø–æ–ª—É—á–∏—Ç –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# app/core/security.py
from passlib.context import CryptContext

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)

# app/api/routes/auth.py
from app.core.security import verify_password
from app.crud import user as user_crud

@router.post("/login", response_model=Token)
def login(payload: LoginRequest, db: Session = Depends(get_db)):
    user = user_crud.get_by_username(db, payload.username)
    if not user or not verify_password(payload.password, user.password_hash):
        raise HTTPException(status_code=401, detail="Invalid credentials")
    
    token = create_access_token(subject=user.username, extra={"role": "admin"})
    return Token(access_token=token)
```

---

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ `datetime.utcnow`

**–§–∞–π–ª:** `app/models/event.py`  
**–°—Ç—Ä–æ–∫–∞:** 18

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
created_at: Mapped[Optional[datetime]] = mapped_column(DateTime, default=datetime.utcnow)
```

`datetime.utcnow()` —É—Å—Ç–∞—Ä–µ–ª —Å Python 3.12 –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç timezone –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```python
from datetime import datetime, timezone

created_at: Mapped[Optional[datetime]] = mapped_column(
    DateTime(timezone=True), 
    default=lambda: datetime.now(timezone.utc)
)
```

---

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

**–§–∞–π–ª:** `app/api/deps.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Ä–º–∏–Ω–∞–ª –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, –Ω–æ –µ–≥–æ API –∫–ª—é—á –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
```python
def get_current_terminal(
    authorization: str = Header(...),
    db: Session = Depends(get_db)
) -> Terminal:
    if not authorization.startswith("Bearer "):
        raise HTTPException(status_code=401, detail="Invalid authorization header")
    
    api_key = authorization.replace("Bearer ", "")
    terminal = terminal_crud.get_by_api_key(db, api_key)
    
    if not terminal:
        raise HTTPException(status_code=401, detail="Invalid API key")
    
    # –ù–û–í–ê–Ø –ü–†–û–í–ï–†–ö–ê
    if not terminal.is_active:
        raise HTTPException(status_code=403, detail="Terminal is deactivated")
    
    return terminal
```

---

## üü° –°–ï–†–¨–ï–ó–ù–´–ï (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

### 4. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞

**–§–∞–π–ª:** `app/api/routes/events.py`  
**–°—Ç—Ä–æ–∫–∏:** 8, 11

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
from app.models.terminal import Terminal
# ...
from app.models.terminal import Terminal  # ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –æ–¥–∏–Ω –∏–∑ –∏–º–ø–æ—Ä—Ç–æ–≤.

---

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è –≤ —Å–ø–∏—Å–∫–∞—Ö

**–§–∞–π–ª:** `app/api/routes/employees.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

```python
@router.get("/employees")
def get_employees(db: Session = Depends(get_db)):
    employees = employee_crud.get_all(db)  # ‚ùå –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å 10000+ –∑–∞–ø–∏—Å–µ–π
    return employees
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
from fastapi import Query

@router.get("/employees")
def get_employees(
    skip: int = Query(0, ge=0),
    limit: int = Query(100, ge=1, le=1000),
    db: Session = Depends(get_db)
):
    employees = employee_crud.get_all(db, skip=skip, limit=limit)
    total = employee_crud.count(db)
    
    return {
        "items": employees,
        "total": total,
        "skip": skip,
        "limit": limit
    }
```

---

### 6. –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π

**–§–∞–π–ª:** `app/crud/event.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ —Å–æ–±—ã—Ç–∏—è "IN" –ø–æ–¥—Ä—è–¥ –∏–ª–∏ –¥–≤–∞ "OUT" –ø–æ–¥—Ä—è–¥.

**–†–µ—à–µ–Ω–∏–µ:**
```python
def create_event(
    db: Session,
    employee_id: int,
    terminal_id: int,
    direction: str,
    ts: datetime,
) -> Event:
    # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    last_event = (
        db.query(Event)
        .filter(Event.employee_id == employee_id)
        .order_by(Event.ts.desc())
        .first()
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    if last_event and last_event.direction == direction:
        raise ValueError(
            f"Cannot create {direction} event: last event was also {direction}. "
            f"Expected {'OUT' if direction == 'IN' else 'IN'}."
        )
    
    # –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
    event = Event(
        employee_id=employee_id,
        terminal_id=terminal_id,
        direction=direction,
        ts=ts,
    )
    db.add(event)
    db.commit()
    db.refresh(event)
    return event
```

---

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª:** `app/api/routes/events.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ª–æ–≥–æ–≤ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É.

**–†–µ—à–µ–Ω–∏–µ:**
```python
import logging

logger = logging.getLogger(__name__)

@router.post("/nfc")
def create_nfc_event(
    payload: NFCEventCreate,
    terminal: Terminal = Depends(get_current_terminal),
    db: Session = Depends(get_db),
):
    logger.info(
        f"NFC event request: terminal={terminal.name}, "
        f"uid={payload.nfc_uid}, direction={payload.direction}"
    )
    
    emp = employee_crud.get_by_uid(db, payload.nfc_uid)
    if not emp:
        logger.warning(f"Employee not found: uid={payload.nfc_uid}")
        raise HTTPException(status_code=404, detail="Employee not found by nfc_uid")
    
    try:
        ev = event_crud.create_event(
            db=db,
            employee_id=emp.id,
            terminal_id=terminal.id,
            direction=payload.direction,
            ts=payload.ts,
        )
        logger.info(
            f"Event created: id={ev.id}, employee={emp.full_name}, "
            f"terminal={terminal.name}, direction={ev.direction}"
        )
    except ValueError as e:
        logger.error(f"Event creation failed: {e}")
        raise HTTPException(status_code=400, detail=str(e))
    
    return {
        "ok": True,
        "event": {
            "id": ev.id,
            "employee_id": ev.employee_id,
            "terminal_id": ev.terminal_id,
            "direction": ev.direction,
            "ts": ev.ts.isoformat(),
        },
        "employee": {"id": emp.id, "full_name": emp.full_name},
        "terminal": {"id": terminal.id, "name": terminal.name},
    }
```

---

### 8. –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ cooldown –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏

**–§–∞–π–ª:** `app/crud/event.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ —Å–æ–±—ã—Ç–∏—è —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –≤ 1 —Å–µ–∫—É–Ω–¥—É.

**–†–µ—à–µ–Ω–∏–µ:**
```python
from datetime import datetime, timedelta
from app.core.config import settings

def create_event(
    db: Session,
    employee_id: int,
    terminal_id: int,
    direction: str,
    ts: datetime,
) -> Event:
    # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ
    last_event = (
        db.query(Event)
        .filter(Event.employee_id == employee_id)
        .order_by(Event.ts.desc())
        .first()
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cooldown
    if last_event:
        time_diff = (ts - last_event.ts).total_seconds()
        if time_diff < settings.terminal_scan_cooldown_seconds:
            raise ValueError(
                f"Too soon after last event. "
                f"Cooldown: {settings.terminal_scan_cooldown_seconds}s, "
                f"actual: {time_diff:.1f}s"
            )
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
        if last_event.direction == direction:
            raise ValueError(
                f"Cannot create {direction} event: last event was also {direction}"
            )
    
    # –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
    event = Event(
        employee_id=employee_id,
        terminal_id=terminal_id,
        direction=direction,
        ts=ts,
    )
    db.add(event)
    db.commit()
    db.refresh(event)
    return event
```

---

## üü¢ –ú–ï–õ–ö–ò–ï (–º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ)

### 9. UTF-8 BOM –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª—ã:**
- `app/models/user.py`
- `app/models/employee.py`
- `app/api/routes/auth.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–æ–≤ –µ—Å—Ç—å —Å–∏–º–≤–æ–ª BOM `\ufeff`:
```python
Ôªøfrom sqlalchemy import String  # ‚Üê BOM —Å–∏–º–≤–æ–ª
```

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å BOM –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ:
- VS Code: File ‚Üí Preferences ‚Üí Settings ‚Üí Files: Encoding ‚Üí UTF-8
- Notepad++: Encoding ‚Üí Convert to UTF-8 (without BOM)

–ò–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–º:
```python
# fix_bom.py
import os

def remove_bom(file_path):
    with open(file_path, 'rb') as f:
        content = f.read()
    
    if content.startswith(b'\xef\xbb\xbf'):
        with open(file_path, 'wb') as f:
            f.write(content[3:])
        print(f"Fixed: {file_path}")

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
for root, dirs, files in os.walk('app'):
    for file in files:
        if file.endswith('.py'):
            remove_bom(os.path.join(root, file))
```

---

### 10. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç docstrings

**–§–∞–π–ª—ã:** –ú–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `app/crud/`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
def get_by_uid(db: Session, uid: str):
    return db.query(Employee).filter(Employee.nfc_uid == uid).first()
```

**–†–µ—à–µ–Ω–∏–µ:**
```python
def get_by_uid(db: Session, uid: str) -> Optional[Employee]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ NFC UID.
    
    Args:
        db: –°–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        uid: NFC UID –∫–∞—Ä—Ç—ã
    
    Returns:
        Employee –æ–±—ä–µ–∫—Ç –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    return db.query(Employee).filter(Employee.nfc_uid == uid).first()
```

---

### 11. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

**–§–∞–π–ª:** `app/api/routes/register.py` (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–≥—É—Ç –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å autoflake
pip install autoflake

# –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
autoflake --remove-all-unused-imports --in-place --recursive app/
```

---

### 12. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ë–î

**–§–∞–π–ª:** `app/api/routes/employees.py`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç —Å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º.

**–†–µ—à–µ–Ω–∏–µ:**
```python
from sqlalchemy.exc import OperationalError, IntegrityError

@router.post("/employees")
def create_employee(
    payload: EmployeeCreate,
    db: Session = Depends(get_db)
):
    try:
        employee = employee_crud.create(db, payload)
        return employee
    except IntegrityError as e:
        db.rollback()
        logger.error(f"IntegrityError: {e}")
        raise HTTPException(
            status_code=400,
            detail="Employee with this NFC UID already exists"
        )
    except OperationalError as e:
        logger.error(f"Database error: {e}")
        raise HTTPException(
            status_code=503,
            detail="Database temporarily unavailable"
        )
    except Exception as e:
        logger.exception(f"Unexpected error: {e}")
        raise HTTPException(
            status_code=500,
            detail="Internal server error"
        )
```

---

### 13. SQL Injection —Ä–∏—Å–∫ (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ORM)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –Ω–æ –Ω—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º —Å raw SQL.

**–ü–ª–æ—Ö–æ:**
```python
# ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö
db.execute(f"SELECT * FROM employees WHERE nfc_uid = '{uid}'")
```

**–•–æ—Ä–æ—à–æ:**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
db.query(Employee).filter(Employee.nfc_uid == uid).first()
```

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| ‚Ññ | –ü—Ä–æ–±–ª–µ–º–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –§–∞–π–ª | –†–µ—à–µ–Ω–æ |
|---|----------|-------------|------|--------|
| 1 | –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | auth.py | ‚ùå |
| 2 | –£—Å—Ç–∞—Ä–µ–≤—à–∏–π datetime.utcnow | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | event.py | ‚ùå |
| 3 | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | deps.py | ‚ùå |
| 4 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ | üü° –°–µ—Ä—å–µ–∑–Ω–æ | events.py | ‚ùå |
| 5 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è | üü° –°–µ—Ä—å–µ–∑–Ω–æ | employees.py | ‚ùå |
| 6 | –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π | üü° –°–µ—Ä—å–µ–∑–Ω–æ | event.py | ‚ùå |
| 7 | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | üü° –°–µ—Ä—å–µ–∑–Ω–æ | events.py | ‚ùå |
| 8 | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ cooldown | üü° –°–µ—Ä—å–µ–∑–Ω–æ | event.py | ‚ùå |
| 9 | UTF-8 BOM –≤ —Ñ–∞–π–ª–∞—Ö | üü¢ –ú–µ–ª–∫–æ | user.py –∏ –¥—Ä. | ‚ùå |
| 10 | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç docstrings | üü¢ –ú–µ–ª–∫–æ | crud/*.py | ‚ùå |
| 11 | –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã | üü¢ –ú–µ–ª–∫–æ | –†–∞–∑–Ω—ã–µ —Ñ–∞–π–ª—ã | ‚ùå |
| 12 | –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ë–î | üü¢ –ú–µ–ª–∫–æ | employees.py | ‚ùå |

---

## üîß –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ù–µ–¥–µ–ª—è 1 - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ (üî¥)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å datetime.utcnow
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

### –ù–µ–¥–µ–ª—è 2 - –°–µ—Ä—å–µ–∑–Ω—ã–µ –±–∞–≥–∏ (üü°)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–æ–±—ã—Ç–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å cooldown –ø—Ä–æ–≤–µ—Ä–∫—É

### –ù–µ–¥–µ–ª—è 3 - –ú–µ–ª–∫–∏–µ –±–∞–≥–∏ (üü¢)
- [ ] –£–¥–∞–ª–∏—Ç—å BOM –∏–∑ —Ñ–∞–π–ª–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å docstrings
- [ ] –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –±–∞–≥–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```python
# test_fixes.py
import pytest

def test_password_hashing():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π"""
    from app.core.security import get_password_hash, verify_password
    
    password = "test123"
    hashed = get_password_hash(password)
    
    assert hashed != password
    assert verify_password(password, hashed)
    assert not verify_password("wrong", hashed)

def test_event_sequence_validation():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π"""
    # –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ IN
    # –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–Ω–æ IN
    # –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞
    pass

def test_pagination():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏"""
    # –°–æ–∑–¥–∞—Ç—å 150 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    # –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å limit=100
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤–µ—Ä–Ω—É–ª–æ—Å—å 100
    pass
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
pytest tests/test_fixes.py -v
```
